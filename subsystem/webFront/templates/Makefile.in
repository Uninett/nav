##
## Makefile for Cheetah templates
##
SHELL = @SHELL@
INSTALL = @INSTALL@
CHEETAH = @CHEETAH@

prefix = @prefix@
exec_prefix = @exec_prefix@
libdir = @libdir@

pythonlibdir = @pythonlibdir@
templatedir = ${pythonlibdir}/nav/web/templates
webroot = @webroot@

sources = $(wildcard *.tmpl) $(wildcard useradmin/*.tmpl)
templates = $(patsubst %.tmpl,%.py, $(sources))
backups = $(patsubst %.py,%.py.bak, $(templates))

.PHONY: all install install-lib clean distclean print

all: $(templates)

$(templates): %.py: %.tmpl
	$(CHEETAH) compile $<

print:
	@echo Sources
	@echo $(sources)
	@echo ---
	@echo Templates
	@echo $(templates)

install: install-lib

install-lib: $(templates)
	@for file in $(templates); do \
	  $(INSTALL) -D -v -m 644 $$file $(DESTDIR)/$(templatedir)/$$file || exit 1; \
	done
	touch $(DESTDIR)$(templatedir)/__init__.py
	@$(INSTALL) -D -v -m 644 useradmin/__init__.py $(DESTDIR)/$(templatedir)/useradmin/__init__.py

clean:
	rm -f *~ 
	rm -f $(templates)
	rm -f $(backups)

distclean: clean
	rm -f Makefile
