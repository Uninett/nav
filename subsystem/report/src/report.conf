#
# $Id$
# 
# Configuration file for the report generator
#
# variables starts with '$', and comments with '#'
# values must be within double quates (") and lines must end with a semicolon (;)
# $sql is the sql-query. line break and white space is allowed.
# $order_by defines the default ordering of the sql query. By clicking on the column headers
#   in the report, you can sort/reverse sort on other criteria.
# $title ($overskrift) is the report title as shown on web
# $extra ($ekstra) are extra columns that can be used for hyperlinks (see $url)
# $hide ($skjul) are columns that must be included in the $sql because they are used in
#   a $url, see below. $hide will not show the column in the report.
# $sum shows the total of a given column (may not work...)
# $count angir kolonner som skal telles
# $name_MYCOL ($navn_MYCOL) changes the column header.
# $url_MYCOL makes a hyperlink
# $explain_MYCOL ($forklar_MYCOL) shows an explaination as popup in the browser when you
# hold the curser over the column header.
#
# ---------------------------------------------------------------------
# netbox related reports
#

netbox {
$sql="
SELECT roomid,sysname,ip,catid,sub,typeid,typename,
       orgid,netbox.up,modules,swport,gwport,
       'Mem',snmp,val AS Function,netbox.netboxid,prefixid
       FROM type
       RIGHT OUTER JOIN netbox USING (typeid)
       LEFT JOIN (SELECT netboxid,count(netboxid) AS gwport
                       FROM gwport JOIN module USING (moduleid)
                       GROUP BY netboxid) tempaggr1 USING (netboxid)
       LEFT JOIN (SELECT netboxid,count(netboxid) AS swport
                       FROM swport JOIN module USING (moduleid)
                       GROUP BY netboxid) tempaggr2 USING (netboxid)
       LEFT JOIN (SELECT netboxid,count(netboxid) AS modules
                       FROM module
                       GROUP BY netboxid) tempaggr3 USING (netboxid)
       LEFT JOIN (SELECT netboxid,count(netboxid) AS sub
                       FROM netboxcategory
                       GROUP BY netboxid) tempaggr4 USING (netboxid)
       LEFT JOIN (SELECT netboxid,count(netboxid) AS snmp
                       FROM netboxsnmpoid 
                       GROUP BY netboxid) tempaggr5 USING (netboxid)
       LEFT JOIN netboxinfo ON (netbox.netboxid=netboxinfo.netboxid AND var='function')
";
$hide = "netboxid,prefixid,typeid";
$order_by="roomid";
$title = "Devices in Operation";
$name_sysname="Name";
$name_catid="Cat";
$name_ip="IP address";
$name_typename="Type";
$name_roomid="Room";
$name_orgid="Org";
$name_up="Up";
$url_roomid="room?roomid=$roomid";
$url_sysname="/browse/$sysname";
$url_typename="type?typeid=$typeid";
$url_orgid="org?orgid=$orgid";
$url_ip="prefix?prefixid=$prefixid";
$url_catid="netbox?catid=$catid";
$url_sub="netboxinfo?netboxid=$netboxid";
$url_modules="modules?sysname=$sysname";
$url_Mem="mem?sysname=$sysname";
$url_swport="swport?b1.netboxid=$netboxid";
$url_gwport="gwport?netboxid=$netboxid";
$url_up="/status/history/?type=boxes&id=$netboxid";
$url_Function="netbox?val=$Function";
$url_snmp="netboxsnmpoid?netboxid=$netboxid";
$explain_Mem="Memory";
$explain_swp="Switch Ports";
$explain_gwp="Router Ports";
$explain_up="Status";
$explain_snmp="#SNMP OIDs classified";
$explain_sub="Sub category"; 
$sum="swport";
}

netbox2 {
$sql = "select roomid,sysname,ip,catid,sub,typename,orgid,up,modules,swport,gwport,mem,snmp,function,netboxid,prefixid,typeid FROM netboxreport";
$hide = "netboxid,prefixid,typeid";
$order_by="roomid";
$title = "Devices in Operation";
$name_sysname="Name";
$name_catid="Cat";
$name_ip="IP address";
$name_typename="Type";
$name_roomid="Room";
$name_orgid="Org";
$name_up="Up";
$url_roomid="room?roomid=$roomid";
$url_sysname="/browse/$sysname";
$url_typename="type?typeid=$typeid";
$url_orgid="org?orgid=$orgid";
$url_ip="prefix?prefixid=$prefixid";
$url_catid="netbox?catid=$catid";
$url_sub="netboxinfo?netboxid=$netboxid";
$url_modules="modules?sysname=$sysname";
$url_Mem="mem?sysname=$sysname";
$url_swport="swport?b1.netboxid=$netboxid";
$url_gwport="gwport?netboxid=$netboxid";
$url_up="/status/history/?type=boxes&id=$netboxid";
$url_Function="netbox?val=$Function";
$url_snmp="netboxsnmpoid?netboxid=$netboxid";
$explain_Mem="Memory";
$explain_swp="Switch Ports";
$explain_gwp="Router Ports";
$explain_up="Status";
$explain_snmp="#SNMP OIDs classified";
$explain_sub="Sub category"; 
$sum="swport";
}

netboxinfo {
$sql="SELECT roomid,sysname,catid,category AS subcat,netboxid 
      FROM netbox 
      LEFT JOIN netboxcategory USING (netboxid)":
$title="Netboxinfo";
$hide="netboxid";
$url_subcat="netboxinfo?category=$subcat";
}

uptime {
$sql="
SELECT roomid,sysname,host(ip),catid,typeid,typename,prefixid,upsince,now()-upsince as uptime
FROM netbox 
JOIN type USING (typeid)";
$title="Uptime";
$hide="typeid,prefixid";
$name_catid="Category";
$name_typename="Type";
$name_roomid="Room";
$name_sysname="Name";
$order_by="upsince desc";
$url_roomid="room?roomid=$roomid";
$url_sysname="/browse/$sysname";
$url_typename="type?typeid=$typeid";
$url_orgid="org?orgid=$orgid";
$url_ip="prefix?prefixid=$prefixid"; 
$url_catid="netbox?catid=$catid";
}

gw {
$sql=" 
SELECT roomid,sysname,host(ip),typeid,typename,orgid,catid,
       sw_ver AS Software,modules,gwport,netboxid,prefixid
       FROM type
            RIGHT OUTER JOIN netbox USING (typeid)
            JOIN device USING (deviceid)
            LEFT JOIN (SELECT netboxid,count(netboxid) AS gwport
                       FROM gwport JOIN module USING (moduleid)
                       GROUP BY netboxid) tempaggr1 USING (netboxid)
            LEFT JOIN (SELECT netboxid,count(netboxid) AS modules
                       FROM module
                       GROUP BY netboxid) tempaggr2 USING (netboxid)
       WHERE catid IN ('GW', 'GSW')";
$title = "Routers"; $name_sysname="Name";
$url_sysname="/browse/$sysname";
$name_main_sw="Software";
$name_orgid="Org";
$name_typename="Type";
$name_roomid="Room";
$order_by="roomid";
$extra="memory";
$hide = "netboxid,typeid,prefixid";
$url_roomid="room?roomid=$roomid";
$url_typename="type?typeid=$typeid";
$url_orgid="org?orgid=$orgid";
$url_gwport="gwport?netboxid=$netboxid";
$url_memory="mem?sysname=$sysname";
$url_modules="modules?sysname=$sysname";
$explain_gwport="Router Ports";
#$explain_mod="Modules";
#$explain_mem="Memory";
}

sw {
$sql="
SELECT roomid,sysname,host(ip),typeid,typename,orgid,catid,
       sw_ver AS Software,modules,swport,netboxid,prefixid
       FROM type
            RIGHT OUTER JOIN netbox USING (typeid)
            JOIN device USING (deviceid)
            LEFT JOIN (SELECT netboxid,count(netboxid) AS swport
                       FROM swport JOIN module USING (moduleid)
                       GROUP BY netboxid) tempaggr1 USING (netboxid)
            LEFT JOIN (SELECT netboxid,count(netboxid) AS modules
                       FROM module
                       GROUP BY netboxid) tempaggr2 USING (netboxid)
       WHERE catid IN ('SW', 'GSW')"; 
$title = "Switches";
$name_sysname="Name";
$url_sysname="/browse/$sysname";
$name_ip="IP address";
$name_orgid="Org";
$name_typename="Type";
$name_roomid="Room";
$order_by="roomid";
$extra="memory";
$hide = "netboxid,typeid,prefixid,catid";
$url_roomid="room?roomid=$roomid";
#$url_ip="prefix?prefixid=$prefixid";
$url_typename="type?typeid=$typeid";
$url_orgid="org?orgid=$orgid";
$url_swport="swport?b1.netboxid=$netboxid";
$url_memory="mem?sysname=$sysname";
$url_modules="modules?sysname=$sysname";
}

edge {
$sql="
SELECT roomid,sysname,host(ip),typeid,typename,orgid,catid,
       sw_ver AS Software,modules,swport,netboxid,prefixid
       FROM type
            RIGHT OUTER JOIN netbox USING (typeid)
            JOIN device USING (deviceid)
            LEFT JOIN (SELECT netboxid,count(netboxid) AS swport
                       FROM swport JOIN module USING (moduleid)
                       GROUP BY netboxid) tempaggr1 USING (netboxid)
            LEFT JOIN (SELECT netboxid,count(netboxid) AS modules
                       FROM module
                       GROUP BY netboxid) tempaggr2 USING (netboxid)
      WHERE catid='EDGE'";
$title = "Edge switches";
$name_sysname="Name";
$url_sysname="/browse/$sysname";
$name_ip="IP address";
$name_orgid="Org";
$name_typename="Type";
$name_roomid="Room";
$order_by="roomid";
$extra="memory";
$hide = "netboxid,typeid,prefixid,catid";
$url_roomid="room?roomid=$roomid";
#$url_ip="prefix?prefixid=$prefixid";
$url_typename="type?typeid=$typeid";
$url_orgid="org?orgid=$orgid";
$url_swport="swport?b1.netboxid=$netboxid";
$url_memory="mem?sysname=$sysname";
$url_modules="modules?sysname=$sysname";
}

# wlan - wireless

wlan {
$sql = "
SELECT roomid,sysname,host(ip),typeid,typename,orgid,catid,
       sw_ver AS Software,modules,swport,netboxid,prefixid
       FROM type 
            RIGHT OUTER JOIN netbox USING (typeid)
            JOIN device USING (deviceid)
            LEFT JOIN (SELECT netboxid,count(netboxid) AS swport
                       FROM swport JOIN module USING (moduleid)
                       GROUP BY netboxid) tempaggr1 USING (netboxid)
            LEFT JOIN (SELECT netboxid,count(netboxid) AS modules
                       FROM module
                       GROUP BY netboxid) tempaggr2 USING (netboxid)
       WHERE catid='WLAN'";
$title ="Wireless";
$hide = "netboxid,typeid,prefixid,catid";
$order_by="roomid";
$name_sysname = "Name";
$name_roomid="Room";
$name_orgid="Org";
$name_typename="Type";
$url_ip="prefix?prefixid=$prefixid";
$url_sysname = "/browse/$sysname";
$url_typename="type?typeid=$typeid";
$url_roomid = "room?roomid=$roomid"; 
$url_host(ip) = "prefix?prefixid=$prefixid";
$url_orgid="org?orgid=$orgid";
$url_swport="swport?b1.netboxid=$netboxid";
$url_modules="modules?sysname=$sysname";
}


srv {
$sql = "
 SELECT roomid,sysname,host(ip),catid,orgid, count(distinct category) as subcats,
        count(serviceid) as services, val as function, netbox.netboxid,prefixid 
 FROM netbox 
 LEFT JOIN service USING (netboxid) 
 LEFT JOIN netboxcategory USING (netboxid) 
 LEFT JOIN netboxinfo ON (netboxinfo.netboxid=netbox.netboxid AND netboxinfo.var='function') 
 WHERE catid='SRV' 
 GROUP BY roomid,sysname,host(ip),catid,orgid,val,netbox.netboxid,prefixid";
$title = "Servers";
$name_sysname="Name";
$url_sysname="/browse/$sysname";
$name_ip="IP";
$name_orgid="Org";
$name_roomid="Room";
$order_by="roomid";
$hide = "netboxid,prefixid";          
$url_subcats="netboxinfo?netboxid=$netboxid";
$url_ip="prefix?prefixid=$prefixid";
$url_roomid="room?roomid=$roomid";
$url_typeid="type?typeid=$typeid";
$url_orgid="org?orgid=$orgid";
$url_services="servicemon?netboxid=$netboxid";
$url_function="netbox?val=$function";
}


other {
$sql="
 SELECT roomid,sysname,host(ip),catid,category,orgid,netboxid 
 FROM netbox 
 LEFT JOIN netboxcategory USING (netboxid) 
 WHERE catid='OTHER'";
$title = "Other";
$order_by="roomid";
$hide = "netboxid";
$url_roomid="room?roomid=$roomid";
#$url_typeid="type?typeid=$typeid";
$url_orgid="org?orgid=$orgid";
}


servicemon {
$sql="
  SELECT sysname,handler,version,netboxid 
  FROM service 
  LEFT JOIN netbox USING (netboxid)";
$title="Services being monitored";
$name_orgid="Owner";
$hide="netboxid";
$url_sysname="srv?sysname=$sysname";
}
 

device {
$sql = "
 SELECT serial,roomid,sysname,module 
 FROM device 
 JOIN module USING (deviceid) 
 JOIN netbox USING (netboxid)";
$title = "Devices";
$name_roomid="Room";
$name_serial="Serial Number";
$name_sysname="Netbox";
$name_module="Module";
$order_by="roomid,sysname,module,serial";
$url_roomid="room?roomid=$roomid";
$url_sysname="netbox2?sysname=$sysname";
#$url_module="swport?b1.sysname=$sysname&m1.module=$module";
}



# Denne kommer inn når netboxinfo kommer
#$sql="SELECT roomid,sysname,typeid,orgid,software FROM netbox,netboxinfo where 
#catid='GW' AND netbox.netboxid=netboxinfo.netboxid";

#modulecat {
#$sql="SELECT typename,sysName,module,serial,sw,hw FROM netbox JOIN module USING (netboxid) left join device using (deviceid) LEFT OUTER JOIN type USING (typeid) WHERE typegroupid='cat-sw' order by sysName,modulenumber";
#$name_typename = "Type";
#$title = "Catalyst";
#$order_by="sysname";
#}

#modultype {
#$sql="SELECT model,descr,count(model) AS antall FROM module GROUP BY model,descr";
#$title=Modultyper";
#$url_antall="modules?model=$model";
#}

#masse ting tatt ut: model, ports portsup etc

modules {
$sql="
 SELECT roomid,sysname,module AS mn,descr,serial,sw_ver AS Software,hw_ver AS Hardware,fw_ver AS Firmware
 FROM netbox 
 JOIN module USING (netboxid) 
 JOIN device ON module.deviceid=device.deviceid";
$title = "Modules";
$order_by="roomid,sysname,mn";
$url_roomid="room?roomid=$roomid";
$url_sysname="netbox2?sysname=$sysname";
$url_mn="swport?b1.sysname=$sysname&m1.module=$mn";
$explain_mn="Module number";
}

mem {
$sql="
 SELECT sysname,catid,typename,memtype,device,to_char(size,'999G999G999G999') AS size,
  to_char(used,'999G999G999G999') AS used,
  to_char(size-used,'999G999G999G999') AS free,
  TO_CHAR((used/(size+0.0001))*100, '999')::int AS used_pst 
 FROM netbox JOIN mem USING (netboxid) 
 LEFT JOIN type USING (typeid)";
$order_by="sysname,catid,memtype,device";
$title = "Memory";
$name_used_pst = "used %"
$url_sysname="netbox2?sysname=$sysname";
$url_memtype="mem?memtype=$memtype";
$url_device="mem?device=$device";
$url_typename="type?typename=$typename";
}

# ---------------------------------------------------------------------
# router port / prefix - related reports
#
gwport {
$sql= "
 SELECT sysname,interface,speed,gwip,vlan,nettype,netident,netboxid,prefix.prefixid 
 FROM netbox 
 JOIN module USING (netboxid) 
 JOIN gwport USING (moduleid) 
 JOIN gwportprefix USING (gwportid) 
 JOIN prefix ON gwportprefix.prefixid=prefix.prefixid 
 JOIN vlan USING (vlanid)";
$title = "Router ports";
#kolonner som må være med i søket, men som helst ikke bør vises.
$hide = "netboxid,prefixid";
//nye navn
$name_sysname="Router";
$name_interface="Router port";
$name_gwip="IP address";
$name_speed="Mbps";
#$name_netaddr="M";
#$name_ospf="O";
#$name_active_ip_cnt="No";
#$name_prefixid="p";
$order_by="sysname,vlan,interface";
$url_gwip="prefix?prefixid=$prefixid";
$url_sysname="netbox2?sysname=$sysname";
$url_vlan="swportv?vlan.vlan=$vlan";
#$url_active_ip_cnt="/res/arp/arp_sok.php?prefixid=$prefixid&dns=on";
#$explain_m="Mask of subnet";
#$explain_o="OSPF cost";
#$explain_ant="No of computers";
#$sum="active_ip_cnt";
}

prefix {
$sql="
 SELECT host,m,prefixreport.vlan,antgw,prefixreport.nettype,prefixreport.netident,
   prefixreport.orgid,prefixreport.usageid,prefixreport.description,act,
   prefixid,prefixreport.vlanid
 FROM prefixreport";
$title = "Prefixes in use";
$order_by="prefixreport.netaddr";
$name_netaddr = "Network";
$name_m="Mask";
$hide = "prefixid,vlanid";
$url_antgw="gwport?vlanid=$vlanid";
#$url_antnetbox="netbox?prefixid=$prefixid";
$url_vlan="swportv?vlan.vlan=$vlan";
$url_orgid="org?orgid=$orgid";
$url_usageid="usage?usageid=$usageid";
##krasjer alt, av en eller annen grunn
$url_act="/machinetracker/ip?prefixid=$prefixid&days=-1";
$explain_m="Mask of subnet";
#$explain_komm="Comment";
$explain_act="No of active IP's";
$explain_antgw="No of gateways connected";
#$explain_antnetbox="Netboxes connected";
$sum="act";
}

prefix1 {
$sql = "
 SELECT host(netaddr) AS Network,masklen(netaddr) AS Mask,gwip AS Gateway,
  sysname,vlan.vlan,nettype,vlan.orgid,usageid,netident,prefix.prefixid,hsrp 
 FROM vlan 
 JOIN prefix USING (vlanid) 
 JOIN gwportprefix USING (prefixid) 
 JOIN gwport USING (gwportid) 
 JOIN module USING (moduleid) 
 JOIN netbox USING (netboxid)";
$title = "Prefixes";
$order_by="netaddr,gwip";
$name_sysname="Netbox";
$name_orgid="Org";

$hide = "prefixid,hsrp";
$url_sysname="netbox2?sysname=$sysname";
#$url_antnetbox="netbox?prefixid=$prefixid";
$url_vlan="swportv?vlan.vlan=$vlan";
$url_orgid="org?orgid=$orgid";
$url_usageid="usage?usageid=$usageid";
##krasjer alt, av en eller annen grunn
##$url_active_ip_cnt="/res/arp/arp_sok.php?prefixid=$prefixid?dns=on";
#$explain_m="Mask of subnet";
#$explain_komm="Comment";
#$explain_ant="No of computers";
#$explain_antgw="No of gateways connected";
#$explain_antnetbox="Netboxes connected";
#$sum="active_ip_cnt";
}


# prefix rapport som også viser rutere
#masklen(netaddr),
prefixmgw {
$sql = "
 SELECT netaddr,sysname,vlan,nettype,netident,vlan.orgid,usageid,prefix.prefixid 
 FROM vlan 
 JOIN prefix USING (vlanid) 
 JOIN gwportprefix USING (prefixid) 
 JOIN gwport USING (gwportid) 
 JOIN module USING (moduleid) 
 JOIN netbox USING (netboxid)";
$title = "Prefixes in use, and their connected gateways";
$order_by="netaddr";
$name_host(netaddr) = "Network";
$name_masklen(netaddr)="M";
$name_netaddr = "Network";
$name_sysname = "Gateway";
$hide = "prefixid";
$url_sysname="netbox2?sysname=$sysname";
$url_host(netaddr)="gwport?prefixid=$prefixid";
$url_masklen(netaddr)="netbox?prefixid=$prefixid";
$url_vlan="swportv?vlan.vlan=$vlan";
$url_orgid="org?orgid=$orgid";
$url_usageid="usage?usageid=$usageid";
}

# ---------------------------------------------------------------------
# switch port related reports
#

# Denne viser trunk som en rad og angir ikke vlan her. Vi viser også to_netboxid
swport0 {
$sql="
 SELECT b1.sysname,module,port,link,speed,duplex,media,trunk,
  vlan.vlan,b2.sysname AS to_netboxid,
  portname, swport.swportid, b1.netboxid AS netboxiid,b1.catid 
 FROM swport 
 JOIN module USING (moduleid) 
 JOIN netbox AS b1 USING (netboxid) 
 LEFT JOIN netbox AS b2 ON (to_netboxid=b2.netboxid) 
 LEFT JOIN swportvlan ON (swport.swportid=swportvlan.swportid AND (trunk='f' 
      OR trunk IS NULL)) 
 LEFT JOIN  vlan USING (vlanid)"
$title = "Switchports";
$hide = "swportid,netboxiid,catid";
$name_sysname = "Switch";
$name_to_netboxid = "Netbox connected";
$name_speed = "Mbps";
$order_by="b1.sysname,module,port";
$url_sysname="netbox2?sysname=$sysname";
$url_module="modules?sysname=$sysname&module=$module";
#$url_port="/browse/$sysname/";
#$url_port="/browse/$sysname/module$module/port$port/";
$url_netboxid="netbox2?netboxid=$netboxid";
$url_trunk="swportv?swportid=$swportid";
$url_vlan="prefix?vlan=$vlan";
$url_to_netboxid="netbox2?sysname=$to_netboxid";
$url_swportid="swport?swport.swportid=$swportid";
}
#$extra = "macbak";
#$url_macbak="/res/local/spor_port.php?ip=$port?up=$modul%3A$port";

swport {
$sql="
 SELECT b1.sysname,s1.interface, m1.module, s1.port, s1.link, s1.speed, s1.duplex, 
   s1.media,s1.trunk, CASE WHEN s1.trunk THEN '1' ELSE '' END AS allowvlan, vlan.vlan,s1.portname, b2.sysname AS to_netboxid,
   m2.module AS remote_module, s1.swportid,
   b1.netboxid AS netboxid, b1.catid FROM swport AS s1
  JOIN module AS m1 USING (moduleid)
  JOIN netbox AS b1 USING (netboxid)
  LEFT JOIN netbox AS b2 ON (to_netboxid=b2.netboxid)
  LEFT JOIN swportvlan ON (s1.swportid=swportvlan.swportid AND (trunk=false OR trunk IS NULL))
  LEFT JOIN vlan using(vlanid)
  LEFT JOIN swport AS s2 ON (s1.to_swportid=s2.swportid)
  LEFT JOIN module AS m2 ON (s2.moduleid=m2.moduleid)";
$title="Switchports";
$hide = "swportid,netboxid,catid";
$name_sysname = "Switch";
$name_to_netboxid = "Connected to netbox";
$name_remote_module="Module";
$name_speed = "Mbps";
$order_by="b1.sysname,module,port";
$url_sysname="netbox2?sysname=$sysname";
$url_module="modules?sysname=$sysname&module=$module";
$url_port="/machinetracker/swp?switch=$sysname&module=$module&port=$port";
$url_netboxid="netbox2?netboxid=$netboxid";
$url_trunk="swportv?swportid=$swportid";
$url_allowvlan="allowedvlan?allowedvlan_both.swportid=$swportid";
$url_vlan="prefix?vlan=$vlan";
$url_to_netboxid="netbox2?sysname=$to_netboxid";
#$url_remote_module="swport2?s1.swportid=$swportid";
$url_swportid="swport?swport.swportid=$swportid";
$explain_to_netboxid="Netbox connected";
$explain_remote_module="Module on connected netbox";
}

allowedvlan {
$sql="
  SELECT allowedvlan_both.swportid, sysname, interface, module, port, allowedvlan FROM allowedvlan_both
  JOIN swport ON(swport.swportid=allowedvlan_both.swportid2) JOIN
  module USING(moduleid) JOIN netbox USING(netboxid)";
$hide = "swportid";
$title="Allowed VLANs on switchport";
$order_by="netboxid,allowedvlan";
}

swport3 {
$sql="
 SELECT b1.sysname, m1.module, s1.port, s1.interface, s1.ifindex, s1.link, s1.speed, 
   s1.duplex, s1.media, s1.trunk, vlan.vlan, b2.sysname as to_netboxid,
   m2.module AS remote_module, s1.portname, s1.swportid, b1.netboxid AS netboxid, 
   b1.catid 
 FROM swport AS s1 
 JOIN module AS m1 USING (moduleid) 
 JOIN netbox AS b1 USING (netboxid) 
 LEFT JOIN netbox AS b2 ON (to_netboxid=b2.netboxid) 
 LEFT JOIN swportvlan ON (s1.swportid=swportvlan.swportid 
   AND (trunk='f' OR trunk IS NULL)) 
 LEFT JOIN vlan using(vlanid) 
 LEFT JOIN swport AS s2 ON (s1.to_swportid=s2.swportid) 
 LEFT JOIN module AS m2 ON (s2.moduleid=m2.moduleid)";
$title="Switchports - debug";
}

swportv {
$sql="
 SELECT b1.sysname,interface,module,port,link,speed,duplex,media,trunk,vlan.vlan,
       b2.sysname AS to_netboxid,portname,swportid,b1.catid
       FROM vlan
       JOIN swportvlan USING (vlanid)
       JOIN swport USING (swportid)
       JOIN module USING (moduleid)
       JOIN netbox AS b1 USING (netboxid)       
       LEFT JOIN netbox AS b2 ON (to_netboxid=b2.netboxid)
";
$title = "Switchports with vlan number";
$hide = "swportid,netboxid,catid";
$name_sysname = "Switch";
$name_to_netboxid = "Netbox connected";
$name_speed = "Mbps";
$order_by="b1.sysname,module,port,vlan.vlan";
$url_sysname="netbox2?sysname=$sysname";
#$url_netboxid="netbox2?netboxid=$netboxid";
$url_trunk="swportv?swportid=$swportid";
$url_vlan="prefix?vlan=$vlan";
$url_to_netboxid="netbox2?sysname=$to_netboxid";
}

topowalk {
$sql="
  SELECT b1.sysname,m1.module AS module1,s1.port AS port1,b2.sysname AS tonetboxid,
    m2.module AS module2,s2.port AS port2 
  FROM swport AS s1 
  INNER JOIN module AS m1 USING (moduleid) 
  JOIN netbox AS b1 USING (netboxid) 
  JOIN netbox AS b2 ON (to_netboxid=b2.netboxid) 
  LEFT JOIN swport AS s2 ON (s1.to_swportid=s2.swportid) 
  LEFT JOIN module as m2 on s2.moduleid=m2.moduleid";
#$order_by="b1.sysname,m1.module,s1.port";
#$title = "Switch topology";
$extra="swbak,gwbak";
#$url_sysname="netbox2?sysname=$sysname";
#$url_to_netboxid="netbox2?sysname=$to_netboxid";
$url_gwbak="topowalkgw?b1.sysname=$tonetboxid";
$url_swbak="topowalk?b1.sysname=$tonetboxid";
}

#kommer sikkert til å fungere like dårlig
topowalkgw{
$sql="
 SELECT b1.sysname,interface,b2.sysname AS to_netboxid,module,s2.port 
 FROM gwport 
 JOIN module USING (moduleid) 
 JOIN netbox AS b1 USING (netboxid) 
 JOIN netbox AS b2 ON (to_netboxid=b2.netboxid) 
 LEFT JOIN swport AS s2 ON (gwport.to_swportid=s2.swportid)";
$title = "Router topology";
$order_by="b1.sysname,interface";
$extra="swbak,gwbak";
$url_sysname="netbox2?sysname=$sysname";
$url_to_netboxid="netbox2?sysname=$to_netboxid";
$url_gwbak="topowalkgw?b1.sysname=$to_netboxid";
$url_swbak="topowalk?b1.sysname=$to_netboxid";
}



# ---------------------------------------------------------------------
# room,sted,type
#

room {
$sql="
  SELECT roomid,count(netboxid) AS nb,locationid,descr,opt1,opt2,opt3,opt4 
  FROM room 
  LEFT JOIN netbox USING (roomid)
  GROUP BY roomid,locationid,descr,opt1,opt2,opt3,opt4";
$title = "Room";
$name_roomid="Room";
$name_nb="Netboxes";
$name_locationid="Location";
$name_descr="Description";
$explain_devices="Number of registered IP devices in this room";
$order_by="roomid";
$url_nb="netbox2?roomid=$roomid";
$url_locationid="location?locationid=$locationid";
#$sum="count(netboxid)";
}

location {
$sql="
  SELECT locationid,count(roomid) AS rooms,location.descr
  FROM location 
  LEFT JOIN room USING (locationid) 
  GROUP BY locationid,location.descr";
$title = "Locations";
$order_by="locationid";
$name_locationid="Location";
$name_descr="Description";
$url_rooms="room?locationid=$locationid";
}

type {
$sql="
  SELECT vendorid,typename,count(distinct netboxid) AS antip,
    count(moduleid) AS antmod,typeid,type.descr,sysobjectid 
  FROM type 
  LEFT JOIN netbox USING (typeid) 
  LEFT JOIN module USING (netboxid) 
  GROUP by type.typename,vendorid,typeid,type.descr,sysobjectid HAVING count(netbox)>0";
$title = "Types of equipment";
$name_typename="Type";
$name_vendorid="Vendor";
$name_descr="Description";
$order_by="vendorid,typename";
$hide = "typeid";
$url_vendorid="vendor?vendorid=$vendorid";
$url_antip="netbox2?typeid=$typeid";     
$url_antmod="modules?typeid=$typeid";
$explain_antip="Number of IP addresses related to this type";
$explain_antmod="Number of modules related to this type";
}


vendor {
$sql = "
  SELECT vendorid,count(distinct netboxid) AS antip,count(moduleid) AS antmod 
  FROM module 
  RIGHT JOIN netbox USING (netboxid) 
  JOIN type USING (typeid) 
  RIGHT JOIN vendor USING (vendorid) 
  GROUP BY vendorid 
  ORDER by vendorid";
$title = "Vendors";
$name_vendorid="Vendor";
$explain_antip="Number of IP addresses related to this vendor";
$explain_antmod="Number of modules related to this vendor";
$url_vendorid="type?vendorid=$vendorid";
}

product {
$sql = "
  SELECT vendorid,productno,count(deviceid) AS devs,descr 
  FROM product 
  RIGHT JOIN device USING (productid) 
  GROUP BY vendorid,productno,descr";
$title = "Products";
$name_vendorid="Vendor";
$name_productno="Product";
$name_devs="Devices";
$explain_devs="Number of devices registered";
$url_vendorid="type?vendorid=$vendorid";
$url_productno="device?productno=$productno";
}

# ---------------------------------------------------------------------
# usage,org
#
usage {
$sql="
  SELECT usageid,count(prefixid) AS antallnett,descr 
  FROM usage 
  LEFT JOIN vlan USING (usageid) 
  LEFT JOIN prefix USING (vlanid) 
  GROUP BY usageid,descr";    
$title = "Usage";
$name_antallnett = "Number of networks";
$name_usageid="Usage"; 
$name_descr="Description";
$order_by="usageid";
$url_antallnett="prefix?usageid=$usageid";
}

org {
$sql = "
  SELECT orgid,count(prefixid) AS antallnett,parent,descr,opt1 AS Contact 
  FROM org 
  LEFT JOIN vlan USING (orgid) 
  LEFT JOIN prefix USING (vlanid) 
  GROUP BY orgid,parent,descr,opt1";
$title = "Organisation";
$name_descr="Description";
$name_parent="Parent";
$name_orgid="Organisational unit";
$order_by="orgid";
$url_parent="org?parent=$parent";
$url_antallnett="prefix?orgid=$orgid";
}

# ---------------------------------------------------------------------
# andre rapporter
#
listkant {
$sql= "
  SELECT vlan,masklen(netaddr),host(ip),sysname 
  FROM netbox 
  JOIN prefix USING (prefixid) 
  LEFT OUTER JOIN vlan USING (vlanid) 
  WHERE (catid='KANT' OR catid='SW') 
  ORDER BY masklen(netaddr),vlan,host(ip)";
$title = Switches/hubs sorted by mask size";
$name_masklen(netaddr) = "Mask";
}

antkant {
$sql = "
  SELECT masklen(netaddr) AS m,count(vlanid) AS v,vlan 
  FROM netbox 
  JOIN prefix USING (prefixid) 
  LEFT OUTER JOIN vlan USING (vlanid) 
  WHERE (catid='KANT' OR catid='SW') 
  GROUP BY vlan,m 
  ORDER BY m,v desc";
$title = "No of SW and KANT on each vlan";
$name_m = "Mask";
$name_v = "No";
}

fantkant{
$sql = "
  SELECT netaddr,count(vlanid) AS v,vlan 
  FROM netbox 
  JOIN prefix USING (prefixid) 
  LEFT OUTER JOIN vlan using (vlanid) 
  WHERE (catid='KANT' OR catid='SW') 
  GROUP BY vlan,netaddr";
}


netboxsnmpoid{
$sql="
  SELECT sysname,oidkey,snmpoid,netboxid 
  FROM netbox 
  JOIN netboxsnmpoid USING (netboxid) 
  JOIN snmpoid USING (snmpoidid)";
$title="Netboxsnmpoid";
$hide="netboxid";
$order_by="sysname,oidkey,snmpoid";
$url_sysname="netboxsnmpoid?sysname=$sysname";
$url_oidkey="netboxsnmpoid?oidkey=$oidkey";
}

#############################

# spanning tree blocked
stpblock {
$sql = "
  SELECT swportblocked.vlan,sysname,module,port,link,portname 
  FROM swportblocked 
  JOIN swport USING (swportid) 
  JOIN module USING (moduleid) 
  JOIN netbox USING (netboxid) 
  WHERE link='y'";
$order_by="vlan,sysname,module,port";
$title = "STP blokkerte porter";
#$url_vlan="?rapport=swportv&vlan=$vlan";
#$url_sysname="?rapport=swportv&sysname=$sysname";
}



#
# EOF
#
