SHELL = @SHELL@
INSTALL = @INSTALL@
CHEETAH = @CHEETAH@

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
libdir = @libdir@
sysconfdir = @sysconfdir@

pythonlibdir = @pythonlibdir@
templatedir = ${pythonlibdir}/nav/web/templates
webroot = @webroot@

templates = AcctChartsTemplate.py AcctDetailTemplate.py AcctSearchTemplate.py \
LogDetailTemplate.py LogTemplate.py

files = radius.py radiuslib.py radius_config.py .htaccess
binfiles = radiusparser.py

.PHONY: all install install-bin install-lib install-web clean distclean

all: $(templates)

$(templates): %.py: %.tmpl
	$(CHEETAH) compile $<

install: install-lib install-web install-bin

install-bin:
	for file in $(binfiles); do \
	  $(INSTALL) -v -D -m 755 $$file $(DESTDIR)$(bindir)/$$file || exit 1; \
	done

install-lib: $(templates)
	for file in $(templates); do \
	  $(INSTALL) -v -D -m 644 $$file $(DESTDIR)$(templatedir)/$$file || exit 1; \
	done

install-web:
	for file in $(files); do \
	  $(INSTALL) -v -D -m 644 $$file $(DESTDIR)$(webroot)/radius/$$file || exit 1; \
	done

clean:
	rm -f *~
	rm -f $(templates)

distclean: clean
	rm -f Makefile
